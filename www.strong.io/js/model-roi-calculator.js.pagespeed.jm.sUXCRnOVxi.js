Number.prototype.formatMoney=function(c,d,t){var n=this,c=isNaN(c=Math.abs(c))?2:c,d=d==undefined?".":d,t=t==undefined?",":t,s=n<0?"-":"",i=String(parseInt(n=Math.abs(Number(n)||0).toFixed(c))),j=(j=i.length)>3?j%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"");};var erfc=function(x){var z=Math.abs(x);var t=1/(1+z/2);var r=t*Math.exp(-z*z-1.26551223+t*(1.00002368+t*(0.37409196+t*(0.09678418+t*(-0.18628806+t*(0.27886807+t*(-1.13520398+t*(1.48851587+t*(-0.82215223+t*0.17087277)))))))))
return x>=0?r:2-r;};var ierfc=function(x){if(x>=2){return-100;}
if(x<=0){return 100;}
var xx=(x<1)?x:2-x;var t=Math.sqrt(-2*Math.log(xx/2));var r=-0.70711*((2.30753+t*0.27061)/(1+t*(0.99229+t*0.04481))-t);for(var j=0;j<2;j++){var err=erfc(r)-xx;r+=err/(1.12837916709551257*Math.exp(-(r*r))-r*err);}
return(x<1)?r:-r;};var Gaussian=function(mean,variance){if(variance<=0){throw new Error('Variance must be > 0 (but was '+variance+')');}
this.mean=mean;this.variance=variance;this.standardDeviation=Math.sqrt(variance);}
Gaussian.prototype.pdf=function(x){var m=this.standardDeviation*Math.sqrt(2*Math.PI);var e=Math.exp(-Math.pow(x-this.mean,2)/(2*this.variance));return e/m;};Gaussian.prototype.cdf=function(x){return 0.5*erfc(-(x-this.mean)/(this.standardDeviation*Math.sqrt(2)));};Gaussian.prototype.ppf=function(x){return this.mean-this.standardDeviation*Math.sqrt(2)*ierfc(2*x);};Gaussian.prototype.mul=function(d){if(typeof(d)==="number"){return this.scale(d);}
var precision=1/this.variance;var dprecision=1/d.variance;return fromPrecisionMean(precision+dprecision,precision*this.mean+dprecision*d.mean);};Gaussian.prototype.div=function(d){if(typeof(d)==="number"){return this.scale(1/d);}
var precision=1/this.variance;var dprecision=1/d.variance;return fromPrecisionMean(precision-dprecision,precision*this.mean-dprecision*d.mean);};Gaussian.prototype.add=function(d){return gaussian(this.mean+d.mean,this.variance+d.variance);};Gaussian.prototype.sub=function(d){return gaussian(this.mean-d.mean,this.variance+d.variance);};Gaussian.prototype.scale=function(c){return gaussian(this.mean*c,this.variance*c*c);};var gaussian=function(mean,variance){return new Gaussian(mean,variance);};var fromPrecisionMean=function(precision,precisionmean){return gaussian(precisionmean/precision,1/precision);};$(document).ready(function(){refresh_values();refresh_roi_plot();$('input').change(function(){refresh_values();refresh_roi_plot();});$('input').keyup(function(){refresh_values();refresh_roi_plot();});});function refresh_values(){$('#model_accuracy_value span').html($('input[name="model_accuracy"]').val());$('#baseline_rate_value span').html($('input[name="baseline_rate"]').val());}
function refresh_roi_plot(){var sd1=1;var sd2=1;var model_auc=$('input[name="model_accuracy"]').val();var baseline_rate=$('input[name="baseline_rate"]').val()/100;var num_customers=$('input[name="num_customers"]').val();var targeted_profit=$('input[name="targeted_profit"]').val();var mistargeted_cost=$('input[name="mistargeted_cost"]').val();var model_data=[];for(var threshold=.01;threshold<.99;threshold=threshold+.01){var std_normal_dist=new Gaussian(0,1);var norm_mean_diff=-Math.sqrt(Math.pow(sd1,2)+Math.pow(sd2,2))*std_normal_dist.ppf(1-model_auc);var positive_dist=new Gaussian(norm_mean_diff/2,sd1);var negative_dist=new Gaussian(-norm_mean_diff/2,sd2);var tpr=(1-positive_dist.cdf(Math.log(threshold/(1-threshold))));var fpr=(1-negative_dist.cdf(Math.log(threshold/(1-threshold))));var gain_per_user=baseline_rate*tpr*targeted_profit;var loss_per_user=(1-baseline_rate)*fpr*mistargeted_cost;var roi=num_customers*(gain_per_user-loss_per_user);model_data.push([threshold,Math.round(roi,0)]);}
$.plot("#roi-graph",[{data:model_data,label:"ROI ($)",color:'#00cbfe'}],{yaxis:{tickLength:0,tickFormatter:(function formatter(val,axis){return'$'+val.formatMoney()})},xaxis:{tickLength:0},lines:{fill:true,lineWidth:3,legend:{show:false},fillColor:{colors:[{opacity:1},{opacity:1}]}},});}